<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Student Performance by Grade Level</title>
		<script src="https://d3js.org/d3.v7.min.js"></script>
		<style type="text/css">
			.legend {
				font-family: sans-serif;
				font-size: 12px;
			}
			text {
				font-family: sans-serif;
				font-size: 12px;
			}
		</style>
	</head>
	<body>
		<h2>Student Performance Distribution</h2>
		<script type="text/javascript">
			// Width and height
			var w = 500;
			var h = 300;
			
			// Dataset: Student counts for each grade and performance level
			var dataset = [
				{ excellent: 45, proficient: 30, needsImprovement: 15 },
				{ excellent: 38, proficient: 35, needsImprovement: 18 },
				{ excellent: 42, proficient: 28, needsImprovement: 20 },
				{ excellent: 50, proficient: 25, needsImprovement: 12 }
			];
			
			// Stack layout setup
			var stack = d3.stack()
						  .keys(["needsImprovement", "proficient", "excellent"]);
			
			// Generate stacked data
			var series = stack(dataset);
			
			// Scales
			var xScale = d3.scaleBand()
				.domain(d3.range(dataset.length))
				.range([50, w-50])
				.paddingInner(0.05);
		
			var yScale = d3.scaleLinear()
				.domain([0, d3.max(dataset, function(d) {
					return d.excellent + d.proficient + d.needsImprovement;
				})])
				.range([h-30, 30]);
				
			// Color scale
			var colors = d3.scaleOrdinal()
				.domain(["needsImprovement", "proficient", "excellent"])
				.range(["#e74c3c", "#f39c12", "#2ecc71"]);
			
			// Create SVG
			var svg = d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);
			
			// Add y-axis
			var yAxis = d3.axisLeft(yScale);
			svg.append("g")
				.attr("transform", "translate(50,0)")
				.call(yAxis);
			
			// Add x-axis labels
			svg.selectAll("text.grade")
				.data(["9th", "10th", "11th", "12th"])
				.enter()
				.append("text")
				.attr("class", "grade")
				.attr("x", function(d, i) { return xScale(i) + xScale.bandwidth()/2; })
				.attr("y", h-10)
				.attr("text-anchor", "middle")
				.text(function(d) { return d; });
			
			// Create groups for bars
			var groups = svg.selectAll("g.bars")
				.data(series)
				.enter()
				.append("g")
				.attr("class", "bars")
				.style("fill", function(d) {
					return colors(d.key);
				});
	
			// Add rectangles for each data point
			groups.selectAll("rect")
				.data(function(d) { return d; })
				.enter()
				.append("rect")
				.attr("x", function(d, i) {
					return xScale(i);
				})
				.attr("y", function(d) {
					return yScale(d[1]);
				})
				.attr("height", function(d) {
					return yScale(d[0]) - yScale(d[1]);
				})
				.attr("width", xScale.bandwidth());
			
			// Add legend
			var legend = svg.selectAll(".legend")
				.data(["Excellent", "Proficient", "Needs Improvement"])
				.enter()
				.append("g")
				.attr("class", "legend")
				.attr("transform", function(d, i) {
					return "translate(0," + (i * 20 + 40) + ")";
				});
			
			legend.append("rect")
				.attr("x", w - 140)
				.attr("width", 18)
				.attr("height", 18)
				.style("fill", function(d, i) {
					return colors(["excellent", "proficient", "needsImprovement"][i]);
				});
			
			legend.append("text")
				.attr("x", w - 120)
				.attr("y", 9)
				.attr("dy", ".35em")
				.text(function(d) { return d; });
		</script>
	</body>
</html>
